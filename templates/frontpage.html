{% extends "core.html" %}

{% load djangoplicity_datetime %}
{% load media_video %}
{% load i18n %} 

{% block extra_header %}
	<meta property="og:title" content="ESO — The European Southern Observatory" />
	<meta property="og:description" content="Welcome to the most powerful astronomical observatories in the world." />
	<meta property="og:image" content="http://www.eso.org/public/archives/images/screen/uhd_yuri_alma_ant_cc.jpg" />
	<meta property="og:image:secure_url" content="https://www.eso.org/public/archives/images/screen/uhd_yuri_alma_ant_cc.jpg" />
{% endblock %}

{% block content_area %}
<div id="pr-carousel-wrapper">
	<div id="pr-carousel">
		{% for release in releases %}
		<div class="slide">
			<a href="{{ release.get_absolute_url }}">
			{% if release.main_image.resource_banner1920 %}
				<img draggable="false" data-lazy="{{ release.main_image.resource_banner1920.url }}" alt="{{ release.main_image.title }}">
			{% else %}
				<img draggable="false" data-lazy="{{ release.main_image.resource_wallpaper3.url }}" alt="{{ release.main_image.title }}">
			{% endif %}
			<div class="pr-content">
				<div class="pr-description">
					<div class="pr-type">{{ release.id }} — {{ release.release_type.name }}</div>
					<div class="pr-title">{{ release.title }}</div>
					<div class="pr-extra">
						<div class="pr-headline">{{ release.headline }}</div>
					</div>
				</div>
			</div>
			</a>
		</div>  <!-- slide -->
		{% endfor %}
	</div> <!-- pr-carousel -->
</div> <!-- pr-carousel-wrapper -->

<div class="container" id="body">

{% if announcements %}
<div class="row announcements">
	<div class="col-md-12">
		<div id="ann-carousel-wrapper">
			<div class="section-header">
				<div class="section-title">
					<a href="{% url 'announcements_defaultquery' %}">{% trans 'Announcements' %}</a>
				</div>
				<div class="section-navigation">
				</div>
			</div>
			<div id="ann-carousel">
				{% for announcement in announcements %}
				<div class="slide">
					<a href="{{ announcement.get_absolute_url }}">
						<div class="ann-description">
							<div class="title">{{ announcement.title }}</div>
							<div class="date">{{ announcement.release_date|date:"j N Y" }} — {{ announcement.id }}</div>
						</div>
						<img draggable="false" data-lazy="{{ announcement.main_visual.resource_thumb350x.url }}" alt="{{ announcement.main_visual.title }}">
						<div class="readmore"></div>
					</a>
				</div> <!-- slide -->
				{% endfor %}
			</div> <!-- ann-carousel -->
		</div> <!-- ann-carousel-wrapper -->
	</div>
</div> <!-- announcements -->
{% endif %}

<div class="row frontpage-section">
	{% if hubblecasts %}
	<script type="text/javascript">
		{% comment %}
		Create array of slides/IDs so that jwplayer can be activated
		on slide changes
		{% endcomment %}
		var hubblecasts_slides = [
		{% spaceless %}
		{% for hubblecast in hubblecasts %}
			"{{ hubblecast.id }}",
		{% endfor %}
		{% endspaceless %}
		];
	</script>
	<div class="col-md-6">
		<div id="hubblecast-carousel-wrapper">
			<div class="section-header">
				<div class="section-title">
					<a href="{% url 'videos_query_category' 'hubblecast' %}">{% trans "Hubblecast" %}</a>
				</div>
				<div class="section-navigation">
				</div>
			</div>
			<div id="hubblecast-carousel">
				{% for hubblecast in hubblecasts %}
				<div class="slide">
					{% embedvideo_subs hubblecast 'medium_podcast,h264' 'hd_and_apple,hd720p_screen,dome_preview' '' hubblecast.videosubtitle_set.all 0 %}
					<a href="{{ hubblecast.get_absolute_url }}">
					<div class="hubblecast-description">
							<div class="date">{{ hubblecast.release_date|datetime:"DATE" }} — {{ hubblecast.id }}</div>
							<div class="title">{{ hubblecast.title }}</div>
					</div>
					</a>
				</div> <!-- slide -->
				{% endfor %}
			</div> <!-- hubblecast-carousel -->
		</div>
	</div>
	{% endif %}
	{% if potws %}
	<div class="col-md-6">
		<div id="potw-carousel-wrapper">
			<div class="section-header">
				<div class="section-title">
					<a href="{% url 'potw_defaultquery' %}">{% trans "Picture of the Week" %}</a>
				</div>
				<div class="section-navigation">
				</div>
			</div>
			<div id="potw-carousel">
				{% for potw in potws %}
				<div class="slide">
					<a href="{{ potw.get_absolute_url }}">
						<img draggable="false" data-lazy="{{ potw.visual.resource_screen640.url }}" class="img-responsive" alt="{{ potw.visual.title }}">
						<div class="potw-description">
							<div class="date">{{ potw.release_date|datetime:"DATE" }} — {{ potw.id }}</div>
							<div class="title">{{ potw.visual.title }}</div>
						</div>
					</a>
				</div> <!-- slide -->
				{% endfor %}
			</div> <!-- potw-carousel -->
		</div>
	</div>
	{% endif %}
	{% if highlights %}
	<div class="col-md-6 highlights">
		<div id="highlight-carousel-wrapper">
			<div class="section-header">
				<div class="section-title">
					{% trans "Highlights" %}
				</div>
				<div class="section-navigation">
				</div>
			</div>
			<div id="highlight-carousel">
			{% for highlight in highlights %}
				{% if highlight.image %}
				<div class="slide">
					{% if highlight.link %}<a href="{{ highlight.link}}">{% endif %}
						<img draggable="false" data-lazy="{{ highlight.image }}" class="img-responsive" alt="{% if highlight.title %}{{ highlight.title }}{% else %}Highlights{% endif %}">
					{% if highlight.link %}</a>{% endif %}
				</div> <!-- slide -->
				{% endif %}
			{% endfor %}
			</div> <!-- highlight-carousel -->
		</div>
	</div>
	{% endif %}
	<div class="col-md-3">
		<div id="hubbleshop-link">
			<a href="/shop/">
				<img src="/static/images/hubbleshop.png" class="img-responsive" alt="Hubble Shop">
			</a>
		</div>
	</div>
	<div class="col-md-3">
		<div id="social-links">
			<div class="title">{% trans "Find us on" %}</div>
			<div class="icons">
				<a href="http://www.facebook.com/HubbleESA"><div class="sprites-facebook_42px_flat"></div></a>
				<a href="http://twitter.com/hubble_space"><div class="sprites-twitter_42px_flat"></div></a>
				<a href="http://www.youtube.com/user/HubbleESA"><div class="sprites-youtube_42px_flat"></div></a>
				<a href="http://itunes.apple.com/de/podcast/hubblecast-hd/id258935617 "><div class="sprites-apple_42px_flat"></div></a>
				<a href="http://www.vimeo.com/hubbleesa"><div class="sprites-vimeo_42px_flat"></div></a>
				<a href="http://www.flickr.com/photos/hubble_esa "><div class="sprites-flickr_42px_flat"></div></a>
			</div>
		</div>
	</div>
</div>

{% if top100 %}
<div class="row top100">
	<div class="col-md-12">
		<div id="top100-frontpage-carousel-wrapper">
			<div class="section-header">
				<div class="section-title">
					<a href="{% url 'images_query_top100' %}">{% trans "Top 100 Images" %}</a>
				</div>
				<div class="section-navigation">
				</div>
			</div>
			<div id="top100-frontpage-carousel">
				{% for image in top100 %}
				<div class="slide">
					<a href="{{ image.get_absolute_url }}">
						<div class="img-wrapper">
							<img draggable="false" data-lazy="{{ image.resource_wallpaper1.url }}" class="img-responsive" alt="{{ image.title }}">
						</div>
						<div class="top100-description">
							<div class="title">{{ image.title }}</div>
						</div>
					</a>
				</div> <!-- slide -->
				{% endfor %}
			</div> <!-- #top100-frontpage-carousel -->
		</div>
	</div>
</div>
{% endif %}

</div> <!-- #body -->

{% endblock content_area %}

{% block extra_scripts %}
<script type="text/javascript">

$(document).ready(function(){                                                   
	{% comment %}
	Set hover target on pr-description, this cannot be done fully in CSS         
	as the image is outside the pr-description and cannot be "attached"          
	by the standard hover                                                        
	{% endcomment %}
    $('.pr-description').hover(function() {
		$(this).parents('.pr-content').prev('img').toggleClass('hover');	
	});

	// Set the announcements titles to the same heights:
	var annTitleSelector = '#ann-carousel .ann-description .title';
	var maxAnnHeight = Math.max.apply(null, $(annTitleSelector).map(function ()
	{
		return $(this).height();
	}).get());
	$(annTitleSelector).height(maxAnnHeight);

	// Setup hubblecasts video
	{% if hubblecasts %}
		setupVideoPlayer('{{ hubblecasts.0.id }}');

		// Activate next hubblecast on slide change
		$('#hubblecast-carousel').on('beforeChange', function(event, slick, currentSlide, nextSlide){
			// Pause all running video players
			for (i = 0 ; ; i++) {
				if (jwplayer(i).pause) {
					// If true then such a video player exists
					jwplayer(i).pause(true);
				}
				else break;
			}

			var video_id = hubblecasts_slides[nextSlide];
			// If we have a video id, and if the slide is not the first one
			// the we set it up
			if (video_id && nextSlide != 0) {
				setupVideoPlayer(video_id);
				// We only need to setup the video player once, so we set the
				// video id to null if the slide is loaded again
				hubblecasts_slides[nextSlide] = null;
			}
		});

	{% endif %}
});                                                                             
            
</script>
{% endblock %}

{% block addthis %}
<!-- no addthis on frontpage -->
{% endblock %}
